# ============================================================================
# NFC-Tap-Logger Service Configuration
# ============================================================================
# This file allows customization of the NFC-Tap-Logger system for different
# festival-based community drug checking services. Each service can have
# different workflows, staffing models, capacity, and operational parameters.
#
# Copy this file and customize it for your specific service needs.
# ============================================================================

# ----------------------------------------------------------------------------
# SERVICE IDENTITY & BRANDING
# ----------------------------------------------------------------------------
service:
  name: "Drug Checking Service"
  description: "Festival Community Drug Checking"
  type: "festival"  # Options: festival, venue, popup, mobile
  organization: "Your Organization Name"
  contact:
    display: true
    info: "For questions, ask a peer worker"
  hours:
    display: true
    schedule: "12:00 PM - 11:00 PM"
    timezone: "UTC"

# ----------------------------------------------------------------------------
# WORKFLOW STAGES CONFIGURATION
# ----------------------------------------------------------------------------
# Define the stages that participants move through in your service.
# Each stage has:
#   - id: Internal identifier (used in code/database)
#   - label: Display name (shown to users)
#   - description: What happens at this stage
#   - order: Sequence number (determines flow order)
#   - required: Whether all participants must go through this stage
#   - visible_to_public: Whether this stage appears on public displays
#   - duration_estimate: Expected minutes for this stage (for wait time calculation)
# ----------------------------------------------------------------------------
workflow:
  # Example 1: Simple two-stage workflow (join queue ‚Üí exit)
  # Example 2: Three-stage workflow (join ‚Üí service start ‚Üí exit)
  # Example 3: Four-stage workflow with substance return (join ‚Üí service start ‚Üí substance returned ‚Üí exit)
  # Example 4: Complex workflow (intake ‚Üí consultation ‚Üí testing ‚Üí results ‚Üí exit)

  stages:
    - id: "QUEUE_JOIN"
      label: "Joined Queue"
      description: "Participant joins the queue"
      order: 1
      required: true
      visible_to_public: true
      duration_estimate: 0
      icon: "‚è∞"

    - id: "SERVICE_START"
      label: "Service Started"
      description: "Service interaction begins"
      order: 2
      required: false  # Some services may skip this
      visible_to_public: true
      duration_estimate: 5
      icon: "üî¨"

    - id: "SUBSTANCE_RETURNED"
      label: "Substance Returned"
      description: "Substance handed back to participant"
      order: 3
      required: false  # Optional but recommended for accountability
      visible_to_public: true
      duration_estimate: 1
      icon: "ü§ù"

    - id: "EXIT"
      label: "Service Complete"
      description: "Participant completes service"
      order: 4
      required: true
      visible_to_public: true
      duration_estimate: 0
      icon: "‚úÖ"

  # Optional: Define custom stages for more complex workflows
  # Uncomment and customize as needed:
  #
  # custom_stages:
  #   - id: "INTAKE"
  #     label: "Intake"
  #     description: "Initial consultation and sample intake"
  #     order: 2
  #     required: true
  #     visible_to_public: true
  #     duration_estimate: 3
  #
  #   - id: "TESTING"
  #     label: "Testing"
  #     description: "Sample analysis in progress"
  #     order: 3
  #     required: true
  #     visible_to_public: false  # Don't show to public
  #     duration_estimate: 10
  #
  #   - id: "RESULTS"
  #     label: "Results Discussion"
  #     description: "Results review and harm reduction discussion"
  #     order: 4
  #     required: true
  #     visible_to_public: true
  #     duration_estimate: 7

  # Workflow behavior
  allow_skip_stages: false  # Can participants skip optional stages?
  allow_repeat_stages: false  # Can participants go through a stage multiple times?
  enforce_stage_order: true  # Must stages be completed in order?

  # Stage transition rules
  auto_transitions:
    enabled: false  # Automatically advance stages based on time?
    rules: []
    # Example:
    # - from: "TESTING"
    #   to: "RESULTS"
    #   after_minutes: 15

# ----------------------------------------------------------------------------
# SERVICE CAPACITY & THROUGHPUT
# ----------------------------------------------------------------------------
capacity:
  # How many people can your service handle per hour?
  people_per_hour: 12

  # Average service time per person (in minutes)
  # This is used to calculate wait time estimates
  avg_service_minutes: 5

  # Multipliers for different conditions
  multipliers:
    peak_hours: 0.8  # Reduce capacity during peak (e.g., 12 * 0.8 = 9.6 people/hour)
    off_peak: 1.2    # Increase during off-peak

  # Default wait time estimate when no data is available (minutes)
  default_wait_estimate: 20

  # Queue position multiplier for wait estimation
  # wait_estimate = queue_position * multiplier (in minutes)
  queue_multiplier: 2

  # Peak hours definition (when to apply peak multiplier)
  peak_hours:
    enabled: false
    ranges:
      - start: "20:00"
        end: "23:00"

# ----------------------------------------------------------------------------
# ALERT THRESHOLDS & OPERATIONAL LIMITS
# ----------------------------------------------------------------------------
# Configure when the system should generate alerts for staff
# ----------------------------------------------------------------------------
alerts:
  queue:
    warning_threshold: 10    # People in queue
    critical_threshold: 20   # People in queue

  wait_time:
    warning_minutes: 45
    critical_minutes: 90

  service_inactivity:
    warning_minutes: 5   # No SERVICE_START events
    critical_minutes: 10

  stuck_cards:
    threshold_hours: 2   # Card hasn't exited after this many hours

  unreturned_substances:
    warning_minutes: 15  # Substance not returned after service start
    critical_minutes: 30  # Critical threshold for unreturned substances

  service_time_variance:
    # Alert if max service time > average * this multiplier
    multiplier: 3

  capacity_utilization:
    critical_percent: 90  # % of capacity being used

  system:
    temperature_critical_celsius: 80
    disk_usage_warning_percent: 80
    disk_usage_critical_percent: 90

  # Custom alert messages
  messages:
    queue_warning: "Queue is getting long ({count} people)"
    queue_critical: "Queue is very long ({count} people) - consider adding staff"
    wait_warning: "Estimated wait time is high ({minutes} min)"
    wait_critical: "Estimated wait time is very high ({minutes} min)"
    inactivity_warning: "No service activity for {minutes} minutes"
    inactivity_critical: "Service appears stopped - no activity for {minutes} minutes"
    unreturned_substance_warning: "Substance not returned for {minutes} minutes - Token {token}"
    unreturned_substance_critical: "URGENT: Substance not returned for {minutes} minutes - Token {token}"

# ----------------------------------------------------------------------------
# UI LABELS & DISPLAY TEXT
# ----------------------------------------------------------------------------
# Customize all user-facing text in the application
# ----------------------------------------------------------------------------
ui:
  labels:
    # Public display
    queue_count: "people in queue"
    wait_time: "estimated wait"
    served_today: "served today"
    avg_service_time: "avg service time"
    service_status: "service status"

    # Status values
    status_active: "ACTIVE"
    status_idle: "IDLE"
    status_stopped: "STOPPED"

    # Dashboard
    current_queue: "Current Queue"
    recent_completions: "Recent Completions"
    system_alerts: "System Alerts"
    queue_analytics: "Queue Analytics"

    # Time units
    minutes_short: "min"
    hours_short: "hr"
    people_short: "ppl"

  branding:
    show_logo: false
    logo_url: ""
    color_scheme: "default"  # Options: default, dark, accessible

  public_display:
    show_queue_positions: true
    show_wait_estimates: true
    show_served_count: true
    show_avg_time: true
    show_service_hours: true
    refresh_interval_seconds: 5

  dashboard:
    show_individual_queue_positions: true
    max_recent_events: 15
    max_recent_completions: 10
    analytics_history_hours: 12

# ----------------------------------------------------------------------------
# STAFFING & ROLES
# ----------------------------------------------------------------------------
# Define staff types, roles, and permissions
# ----------------------------------------------------------------------------
staffing:
  roles:
    - id: "peer_worker"
      label: "Peer Worker"
      description: "Front-line service provider"
      permissions:
        - "scan_nfc"
        - "view_queue"
        - "view_dashboard"

    - id: "coordinator"
      label: "Service Coordinator"
      description: "Shift supervisor"
      permissions:
        - "scan_nfc"
        - "view_queue"
        - "view_dashboard"
        - "view_analytics"
        - "force_exit_participant"
        - "manage_alerts"

    - id: "admin"
      label: "Administrator"
      description: "System administrator"
      permissions:
        - "*"  # All permissions

  # Track staff on duty
  require_staff_id: false  # Require staff to identify themselves?

  # Shift management
  shifts:
    enabled: false
    duration_hours: 4
    handoff_checklist:
      - "Review current queue status"
      - "Check for stuck cards"
      - "Note any issues or patterns"

# ----------------------------------------------------------------------------
# LOCATIONS & MULTI-SITE SUPPORT
# ----------------------------------------------------------------------------
# Configure multiple service locations or stations
# ----------------------------------------------------------------------------
locations:
  # Single location vs multi-location mode
  multi_location: false

  # Define service locations
  sites:
    - id: "main"
      name: "Main Stage"
      description: "Primary drug checking tent"
      enabled: true
      stations:
        - device_id: "station1"
          description: "Intake Station 1"
        - device_id: "station2"
          description: "Intake Station 2"

  # Example multi-location setup (uncomment to use):
  # sites:
  #   - id: "main_stage"
  #     name: "Main Stage Area"
  #     description: "Drug checking near main stage"
  #     enabled: true
  #     stations:
  #       - device_id: "main_station1"
  #       - device_id: "main_station2"
  #
  #   - id: "camp_zone"
  #     name: "Camping Zone"
  #     description: "Drug checking in camping area"
  #     enabled: true
  #     stations:
  #       - device_id: "camp_station1"

  # Cross-location coordination
  shared_queue: false  # Do all locations share one queue?
  show_all_locations: true  # Show all locations on public display?

# ----------------------------------------------------------------------------
# DATA COLLECTION & CUSTOM FIELDS
# ----------------------------------------------------------------------------
# Configure what data to collect at each stage
# ----------------------------------------------------------------------------
data_collection:
  # Standard fields (always collected)
  standard_fields:
    - token_id
    - uid
    - stage
    - timestamp
    - device_id
    - session_id

  # Optional metadata fields
  custom_fields:
    enabled: false
    fields: []
    # Example:
    # - id: "substance_type"
    #   label: "Substance Type"
    #   type: "select"
    #   options: ["Unknown", "Powder", "Pill", "Crystal", "Liquid"]
    #   required_at_stages: ["SERVICE_START"]
    #
    # - id: "test_result"
    #   label: "Test Result"
    #   type: "text"
    #   required_at_stages: ["EXIT"]
    #
    # - id: "staff_notes"
    #   label: "Staff Notes"
    #   type: "textarea"
    #   required_at_stages: []

  # Privacy settings
  anonymize_data: true
  data_retention_days: 90

# ----------------------------------------------------------------------------
# METRICS & REPORTING
# ----------------------------------------------------------------------------
metrics:
  # Time windows for analytics
  windows:
    recent_events: 15        # Number of recent events to show
    recent_completions: 10   # Number of recent completions
    activity_history_hours: 12
    shift_summary_hours: 4
    wait_time_sample_size: 20  # Number of recent completions for avg wait

  # Performance targets (for reporting)
  targets:
    max_wait_time_minutes: 30
    min_people_per_hour: 10
    max_queue_length: 15

  # Export settings
  export:
    enabled: false
    formats: ["csv", "json"]
    schedule: "daily"
    destination: "./exports"

# ----------------------------------------------------------------------------
# INTEGRATION & EXTERNAL SYSTEMS
# ----------------------------------------------------------------------------
integrations:
  # Webhook notifications
  webhooks:
    enabled: false
    endpoints: []
    # Example:
    # - url: "https://your-system.com/webhook"
    #   events: ["queue_critical", "service_stopped"]
    #   auth_header: "Bearer YOUR_TOKEN"

  # External analytics
  analytics:
    enabled: false
    provider: null  # "google_analytics", "matomo", etc.
    tracking_id: ""

  # API access
  api:
    enabled: false
    require_auth: true
    rate_limit_per_minute: 60

# ----------------------------------------------------------------------------
# HARDWARE & DEVICE CONFIGURATION
# ----------------------------------------------------------------------------
# Note: Basic hardware config is in config.yaml
# This section extends hardware config for service-specific needs
# ----------------------------------------------------------------------------
hardware:
  # NFC reader behavior
  nfc:
    duplicate_detection_window_seconds: 1
    success_beep_pattern: [0.1, 0.1, 0.1]
    error_beep_pattern: [0.5]
    duplicate_beep_pattern: [0.1, 0.1, 0.1, 0.1, 0.1]

  # Feedback mechanisms
  feedback:
    audio_enabled: true
    visual_enabled: true
    haptic_enabled: false

  # Multi-reader support
  readers:
    max_concurrent: 2
    auto_detect: true

# ----------------------------------------------------------------------------
# SECURITY & ACCESS CONTROL
# ----------------------------------------------------------------------------
security:
  # Authentication
  authentication:
    enabled: false
    method: "simple"  # Options: simple, oauth, ldap

  # Access control
  access_control:
    public_display_auth: false
    dashboard_auth: false
    admin_auth: true

  # Audit logging
  audit:
    enabled: true
    log_level: "info"  # Options: debug, info, warning, error
    retention_days: 365

  # Network security
  network:
    cors_enabled: true
    allowed_origins: ["*"]
    https_only: false

# ----------------------------------------------------------------------------
# ADVANCED SETTINGS
# ----------------------------------------------------------------------------
advanced:
  # Database settings
  database:
    wal_mode: true
    checkpoint_interval: 1000

  # Performance tuning
  performance:
    cache_enabled: true
    cache_ttl_seconds: 300
    async_processing: true

  # Debug mode
  debug:
    enabled: false
    verbose_logging: false
    show_debug_info: false

  # Feature flags
  features:
    experimental_ui: false
    advanced_analytics: false
    predictive_wait_times: false

# ----------------------------------------------------------------------------
# EXAMPLES & PRESETS
# ----------------------------------------------------------------------------
# Uncomment one of these presets to quick-start with a common configuration
# ----------------------------------------------------------------------------

# PRESET 1: Simple queue (join ‚Üí exit)
# workflow:
#   stages:
#     - {id: "QUEUE_JOIN", label: "Joined Queue", order: 1, required: true}
#     - {id: "EXIT", label: "Complete", order: 2, required: true}

# PRESET 2: Standard service (join ‚Üí service ‚Üí exit)
# [See default configuration above]

# PRESET 3: Service with substance return confirmation (join ‚Üí service ‚Üí substance returned ‚Üí exit)
# workflow:
#   stages:
#     - {id: "QUEUE_JOIN", label: "Joined Queue", order: 1, required: true, duration_estimate: 0}
#     - {id: "SERVICE_START", label: "Service Started", order: 2, required: true, duration_estimate: 5}
#     - {id: "SUBSTANCE_RETURNED", label: "Substance Returned", order: 3, required: true, duration_estimate: 1, icon: "ü§ù"}
#     - {id: "EXIT", label: "Complete", order: 4, required: true, duration_estimate: 0}

# PRESET 4: Detailed workflow (intake ‚Üí consult ‚Üí test ‚Üí results ‚Üí substance returned ‚Üí exit)
# workflow:
#   stages:
#     - {id: "QUEUE_JOIN", label: "Queue", order: 1, required: true, duration_estimate: 0}
#     - {id: "INTAKE", label: "Intake", order: 2, required: true, duration_estimate: 3}
#     - {id: "CONSULT", label: "Consultation", order: 3, required: true, duration_estimate: 5}
#     - {id: "TESTING", label: "Testing", order: 4, required: true, duration_estimate: 10}
#     - {id: "RESULTS", label: "Results", order: 5, required: true, duration_estimate: 7}
#     - {id: "SUBSTANCE_RETURNED", label: "Substance Returned", order: 6, required: true, duration_estimate: 1, icon: "ü§ù"}
#     - {id: "EXIT", label: "Complete", order: 7, required: true, duration_estimate: 0}
